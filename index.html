<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Tabbed Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .tab-container {
            display: flex;
            background-color: #f1f1f1;
        }
        .tab {
            padding: 14px 16px;
            cursor: pointer;
            flex: 1;
            text-align: center;
            background-color: #ddd;
            transition: background-color 0.3s;
        }
        .tab.active {
            background-color: #4CAF50;
            color: white;
        }
        .tab-content {
            padding: 20px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="tab-container">
        <div class="tab" data-file="about.html">About</div>
        <div class="tab" data-file="calendar.html">Calendar</div>
        <div class="tab" data-file="game.html">Game</div>
        <div class="tab" data-file="feedback.html">Feedback</div>
    </div>

    <div id="tab-content" class="tab-content">
        <!-- Content will be loaded here -->
    </div>

    <div id="unity-container" class="hidden">
        <canvas id="unity-canvas" width=960 height=600></canvas>
        <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty">
                <div id="unity-progress-bar-full"></div>
            </div>
        </div>
        <div id="unity-warning"> </div>
        <div id="unity-footer">
            <div id="unity-webgl-logo"></div>
            <div id="unity-fullscreen-button"></div>
            <div id="unity-build-title">Test game</div>
        </div>
    </div>

    <script>
        let currentUnityInstance = null;
        let unityScriptLoaded = false;

        document.addEventListener('DOMContentLoaded', () => {
            // Default tab to load
            const defaultTab = 'about.html';
            const defaultTabElement = document.querySelector(`.tab[data-file="${defaultTab}"]`);
            if (defaultTabElement) {
                activateTab(defaultTabElement);
            }
        });

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                activateTab(this);
            });
        });

        function activateTab(tabElement) {
            const file = tabElement.getAttribute('data-file');

            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

            // Add active class to the clicked tab
            tabElement.classList.add('active');

            // Clear the existing content
            const contentDiv = document.getElementById('tab-content');
            contentDiv.innerHTML = '';

            // Handle Unity container visibility and initialization
            if (file === 'game.html') {
                document.getElementById('unity-container').classList.remove('hidden');
                if (!unityScriptLoaded) {
                    loadUnity();
                    unityScriptLoaded = true;
                }
            } else {
                document.getElementById('unity-container').classList.add('hidden');
                // Clean up Unity instance if it exists
                if (currentUnityInstance) {
                    currentUnityInstance.Quit().then(() => {
                        currentUnityInstance = null;
                        console.log('Unity instance cleaned up');
                    }).catch(err => {
                        console.error('Error cleaning up Unity instance:', err);
                    });
                }
            }

            // Load new tab content
            loadTabContent(file);
        }

        function loadTabContent(file) {
            fetch(file)
                .then(response => response.text())
                .then(data => {
                    const contentDiv = document.getElementById('tab-content');
                    contentDiv.innerHTML = data;

                    // Execute any inline scripts in the loaded content
                    const scripts = contentDiv.querySelectorAll('script');
                    scripts.forEach(script => {
                        const newScript = document.createElement('script');
                        newScript.text = script.text;
                        document.body.appendChild(newScript);
                    });
                })
                .catch(err => {
                    console.error('Error loading content:', err);
                });
        }

        function loadUnity() {
            // Remove any existing Unity canvas if present
            const existingCanvas = document.getElementById('unity-canvas');
            if (existingCanvas) {
                existingCanvas.remove();
            }

            var container = document.querySelector("#unity-container");
            var canvas = document.createElement('canvas');
            canvas.id = 'unity-canvas';
            canvas.width = 960;
            canvas.height = 600;
            container.appendChild(canvas);

            var loadingBar = document.querySelector("#unity-loading-bar");
            var progressBarFull = document.querySelector("#unity-progress-bar-full");
            var fullscreenButton = document.querySelector("#unity-fullscreen-button");
            var warningBanner = document.querySelector("#unity-warning");

            function unityShowBanner(msg, type) {
                function updateBannerVisibility() {
                    warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
                }
                var div = document.createElement('div');
                div.innerHTML = msg;
                warningBanner.appendChild(div);
                if (type == 'error') div.style = 'background: red; padding: 10px;';
                else {
                    if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
                    setTimeout(function() {
                        warningBanner.removeChild(div);
                        updateBannerVisibility();
                    }, 5000);
                }
                updateBannerVisibility();
            }

            var buildUrl = "Build";
            var loaderUrl = buildUrl + "/PiratesPalate_No_Sound_WebGL_v_1_0_3.loader.js";
            var config = {
                dataUrl: buildUrl + "/PiratesPalate_No_Sound_WebGL_v_1_0_3.data",
                frameworkUrl: buildUrl + "/PiratesPalate_No_Sound_WebGL_v_1_0_3.framework.js",
                codeUrl: buildUrl + "/PiratesPalate_No_Sound_WebGL_v_1_0_3.wasm",
                streamingAssetsUrl: "StreamingAssets",
                companyName: "DefaultCompany",
                productName: "PiratesPalate",
                productVersion: "1.0.3",
                showBanner: unityShowBanner,
            };

            if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                var meta = document.createElement('meta');
                meta.name = 'viewport';
                meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
                document.getElementsByTagName('head')[0].appendChild(meta);
                container.className = "unity-mobile";
                canvas.className = "unity-mobile";
                unityShowBanner('WebGL builds are not supported on mobile devices.');
            } else {
                canvas.style.width = "960px";
                canvas.style.height = "600px";
            }

            loadingBar.style.display = "block";

            var script = document.createElement("script");
            script.src = loaderUrl;
            script.onload = () => {
                createUnityInstance(canvas, config, (progress) => {
                    progressBarFull.style.width = 100 * progress + "%";
                }).then((unityInstance) => {
                    loadingBar.style.display = "none";
                    fullscreenButton.onclick = () => {
                        unityInstance.SetFullscreen(1);
                    };
                    currentUnityInstance = unityInstance;
                }).catch((message) => {
                    console.error(message);
                });
            };
            document.body.appendChild(script);
        }
    </script>
</body>
</html>
